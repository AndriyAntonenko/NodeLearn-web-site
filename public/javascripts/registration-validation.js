let validationObj={firstName:!1,lastName:!1,email:!1,password:!1,passwordRepeated:!1},formValid=!1;const button=document.body.querySelector(".btn-registration"),firstName=document.getElementById("firstName"),lastName=document.getElementById("lastName"),email=document.getElementById("email"),password=document.getElementById("password"),passwordRepeated=document.getElementById("repeat-password");let errorMessage=document.createElement("div");function formIsValid(){formValid=validationObj.firstName&&validationObj.lastName&&validationObj.email&&validationObj.password&&validationObj.passwordRepeated,button.disabled=!formValid}function errorMessagePosition(e,t,a,o){let s=e.getBoundingClientRect(),r=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,n=(window.pageXOffset||document.documentElement||document.body.scrollLeft,document.documentElement.clientTop||document.body.clientTop||0);document.documentElement.clientLeft||document.body.clientLeft;errorMessage.style.top=s.top+r-n-e.offsetHeight-15+"px",errorMessage.style.left=s.left+"px",a?(e.style.border=null,e.style.background=null,errorMessage.innerHTML="",errorMessage.hidden=a,validationObj[t]=a):(e.style.border="2px solid #FF4328",e.style.background="#FFC4C3",errorMessage.innerHTML=o,errorMessage.hidden=a,validationObj[t]=a)}function nameValid(e,t){t.target.value.length<2?errorMessagePosition(t.target,e,!1,"Слишком короткое"):errorMessagePosition(t.target,e,!0),formIsValid()}errorMessage.hidden=!0,errorMessage.className="error-message",document.body.appendChild(errorMessage),firstName.oninput=nameValid.bind(this,"firstName"),lastName.oninput=nameValid.bind(this,"lastName"),email.oninput=(e=>{e.target.value.length<6?errorMessagePosition(e.target,"email",!1,"Email слишком короткий"):~e.target.value.indexOf("@")?errorMessagePosition(e.target,"email",!0):errorMessagePosition(e.target,"email",!1,"Email должен содержать @"),formIsValid()}),password.oninput=(e=>{/^[a-zA-Z0-9]+$/.test(e.target.value)?e.target.value.length<6||e.target.value.length>20?errorMessagePosition(e.target,"password",!1,"Пароль: 6-20 символов"):errorMessagePosition(e.target,"password",!0):errorMessagePosition(e.target,"password",!1,"Только латинские буквы и цифры"),formIsValid()}),passwordRepeated.oninput=(e=>{e.target.value!==document.getElementById("password").value?errorMessagePosition(e.target,"passwordRepeated",!1,"Пароли не совпадают"):validationObj.password?errorMessagePosition(e.target,"passwordRepeated",!0):errorMessagePosition(e.target,"passwordRepeated",!1,"Пароль: 6-20 символов"),formIsValid()}),button.onclick=(e=>{const t={firstName:firstName.value,lastName:lastName.value,email:email.value,password:password.value},a=new XMLHttpRequest;a.open("POST","/api/auth/registration",!0),a.setRequestHeader("Content-Type","application/json"),a.onreadystatechange=(()=>{if(4==a.readyState)if(200!=a.status)alert(`${a.status}: ${a.statusText}`);else{console.log(a.responseText);let e=JSON.parse(a.responseText);console.log(e),e.ok?document.location.href="/":errorMessagePosition(document.getElementById(e.field),e.field,!1,e.error)}}),a.send(JSON.stringify(t))});