let commentForm,parent=null,errorMessage=document.createElement("div");function formIsValid(){formValid=validationObj.email&&validationObj.password,button.disabled=!formValid}function errorMessagePosition(e,t,o){let n=e.getBoundingClientRect(),r=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,m=(window.pageXOffset||document.documentElement||document.body.scrollLeft,document.documentElement.clientTop||document.body.clientTop||0);document.documentElement.clientLeft||document.body.clientLeft;errorMessage.style.top=n.top+r-m-e.offsetHeight+40+"px",errorMessage.style.left=n.left+"px",t?(errorMessage.innerHTML="",errorMessage.hidden=t):(errorMessage.innerHTML=o,errorMessage.hidden=t)}function insertAfter(e,t){return t.parentNode.insertBefore(e,t.nextSibling)}errorMessage.className="error-message",errorMessage.hidden=!0,document.body.appendChild(errorMessage),document.getElementById("new").onclick=(e=>{commentForm&&commentForm.parentNode.removeChild(commentForm),parent=null,(commentForm=document.createElement("form")).className="comment-text",commentForm.innerHTML='<textarea name="body"></textarea>\n                           <div class="comment-buttons">\n                           <button class="cancel">Отмена</button>\n                           <button class="send">Отправить</button>\n                           </div>',document.querySelector(".comments").appendChild(commentForm),insertAfter(commentForm,e.target),commentForm.style.display="block"}),document.body.onclick=(e=>{if("cancel"===e.target.className&&(errorMessagePosition(commentForm.querySelector("textarea"),!0),commentForm&&(commentForm.parentNode.removeChild(commentForm),commentForm=null)),"reply"===e.target.id&&(commentForm&&commentForm.parentNode.removeChild(commentForm),parent=null,(commentForm=document.createElement("form")).className="comment-text",commentForm.innerHTML='<textarea name="body"></textarea>\n                             <div class="comment-buttons">\n                             <button class="cancel">Отмена</button>\n                             <button class="send">Отправить</button>\n                             </div>',insertAfter(commentForm,e.target.parentNode),commentForm.style.display="block",parent=e.target.parentNode.id),"send"===e.target.className)if(e.preventDefault(),commentForm.querySelector("textarea").value.length){const e={post:document.body.querySelector(".comments").id,body:commentForm.querySelector("textarea").value,parent:parent};console.log(e);let t=new XMLHttpRequest;t.open("POST","/comment/add",!0),t.setRequestHeader("Content-Type","application/json"),t.onreadystatechange=(()=>{if(4==t.readyState)if(200!=t.status)alert(`${t.status}: ${t.statusText}`);else{console.log(t.responseText);let e=JSON.parse(t.responseText);if(e.ok){let t=document.createElement("ul");t.innerHTML=`<li id=${e.id}><div class="head"><a href="/users/${e.url}">\n               ${e.name}</a>\n               <small class="date">Только что</small></div>\n               ${e.body}<span id="reply">Ответить</span></li>`,insertAfter(t,commentForm),commentForm.style.display="none"}else document.location.href="/authorization"}}),t.send(JSON.stringify(e))}else errorMessagePosition(commentForm.querySelector("textarea"),!1,"Напишите что-то")});